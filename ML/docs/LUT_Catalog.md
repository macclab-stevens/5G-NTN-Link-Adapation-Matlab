# LUT Catalog

All lookup tables generated in this iteration are summarized below. For each LUT you’ll find the path, the command/script that produced it, the source data or model, and any post-processing such as rounding or clipping. Use this as the canonical reference when wiring MATLAB to a specific policy or when regenerating tables after a model retrain.
---

## SNR×CQI Classifier LUT
**Path:** `ML/data/luts/xgb_snr_cqi_classifier/snr_cqi_lut_classifier.csv`

**Purpose:** Recommended 2-D table for MATLAB after we restricted learning to SNR and CQI only.

**Generation Steps:**
1. Extracted raw dataset with MCS≤15
   ```bash
   uv run python - <<'PY'
   import polars as pl
   lf = pl.scan_parquet('features/all.parquet').select(['snr','cqi','mcs'])
   lf = lf.filter(pl.col('mcs') <= 15)
   df = lf.head(2_000_000).collect()
   df.write_csv('data/snr_cqi_dataset_mcs15.csv')
   PY
   ```
2. Trained monotonic classifier
   ```bash
   uv run python train_mcs_mono_xgb.py \
     --lut data/snr_cqi_dataset_mcs15.csv \
     --output-root models/mcs_snr_cqi_dataset \
     --report-dir reports/mcs_snr_cqi_dataset --rounds 200
   ```
3. Exported LUT via classifier mode
   ```bash
   uv run python export_lut.py --mode classifier \
     --model models/mcs_snr_cqi_dataset/model.json \
     --class-index models/mcs_snr_cqi_dataset/class_index.json \
     --classifier-features snr,cqi \
     --data features/all.parquet \
     --out data/luts/xgb_snr_cqi_classifier/snr_cqi_lut_classifier.csv \
     --snr-bin 0.2 --cqi-bin 1 --min-count 200 \
     --fill-cqi-grid --cqi-min 0 --cqi-max 15
   ```

**Post-processing:** LUT values inherently lie in {2,…,9}; no extra clipping required.

---

## Original Dense LUTs (Clipped)
**Paths:**
- `ML/data/snr_cqi_lut_dense.csv` (source LUT provided by project)
- `ML/data/snr_cqi_lut_mcs15.csv` (clipped & rounded)

**Transformation Script:** `filter_snr_cqi_lut.py`
```bash
uv run python filter_snr_cqi_lut.py \
  --input data/snr_cqi_lut_dense.csv \
  --output data/snr_cqi_lut_mcs15.csv --max-mcs 15
```

**Notes:** Applies integer rounding to CQI/MCS and clamps values to [0,15]; serves as baseline for MATLAB integration or classifier training.

---

## Conservative Empirical LUT
**Path:** `ML/data/snr_cqi_lut_empirical_thresh095_low_mcs15.csv`

**Objective:** Low-index LUT (MCS 1–11) derived directly from observed pass rates.

**Generation Commands:**
1. Enabled `lowest_feasible` selection rule in `export_lut_empirical.py`.
2. Exported with conservative settings:
   ```bash
   uv run python export_lut_empirical.py \
     --data features/all.parquet \
     --out data/snr_cqi_lut_empirical_thresh095_low.csv \
     --objective threshold --threshold 0.95 \
     --prob-margin 0.05 --select-rule lowest_feasible \
     --snr-bin 0.1 --cqi-bin 1 --min-count 100 \
     --fill-cqi-grid --cqi-min 0 --cqi-max 15
   ```
3. Clipped & rounded via `filter_snr_cqi_lut.py` (same command as above) to produce the `_mcs15` version.

**MCS Range:** 1–11.

---

## Polynomial / Newton LUTs
**Directory:** `ML/data/polynomial_luts/`

Generated by `polynomial_models.py` using cubic regression and nested Newton interpolation. We clip predictions to [0,27] in the script and export separate files for each method:
- `snr_cqi_poly_lut.csv` / `snr_cqi_newton_lut.csv`
- `snr_cqi_ele_poly_lut.csv` / `snr_cqi_ele_newton_lut.csv`

**Command:**
```bash
uv run python polynomial_models.py \
  --sample 300000 --poly-degree 3 --grid 5,5,5 \
  --snr-step 0.2 --cqi-step 1 --ele-step 5 \
  --output-dir reports/polynomial --lut-dir data/polynomial_luts
```

**MCS Handling:** Script clamps rounded predictions to [0,27]; clip to ≤15 after export if required.

---

## XGB Pass-Probability LUT Attempts
**Directories:** `ML/data/luts/xgb_reduced/` and `ML/data/luts/xgb_snr_cqi/`

LUTs produced with `export_lut.py --mode pass` using the reduced-feature pass models. Because aggregation collapsed pathloss/elevation, most outputs degenerately select a single MCS (0 or 27).

**Example command (threshold objective):**
```bash
uv run python export_lut.py \
  --data features/all.parquet \
  --out data/luts/xgb_synopsis/snr_cqi_lut_threshold.csv \
  --model models/xgb_snr_cqi/xgb_mcs_pass.json \
  --meta models/xgb_snr_cqi/model_meta.json \
  --objective threshold --threshold 0.6 \
  --snr-bin 0.2 --cqi-bin 1 --min-count 200 \
  --fill-cqi-grid --cqi-min 0 --cqi-max 15 --mcs-max 15
```

**Status:** Not recommended for deployment until more context (pathloss/elevation) is included or the threshold/guardrails are heavily relaxed.

---

## Quick Reference Table
| LUT Path | Source | Method | MCS Range | Notes |
| --- | --- | --- | --- | --- |
| `data/luts/xgb_snr_cqi_classifier/snr_cqi_lut_classifier.csv` | `models/mcs_snr_cqi_dataset` | XGB classifier (`--mode classifier`) | 2–9 | Preferred 2-D LUT. |
| `data/snr_cqi_lut_mcs15.csv` | `filter_snr_cqi_lut.py` on dense LUT | Rounding + clipping | 7–15 | Original dense table clipped. |
| `data/snr_cqi_lut_empirical_thresh095_low_mcs15.csv` | `export_lut_empirical.py` | Empirical threshold (0.95, lowest feasible) | 1–11 | Conservative fallback. |
| `data/polynomial_luts/snr_cqi_poly_lut.csv` | `polynomial_models.py` | Polynomial regression | 0–10 (after clamp) | Analytical baseline. |
| `data/polynomial_luts/snr_cqi_newton_lut.csv` | `polynomial_models.py` | Newton interpolation | 2–10 | Analytical baseline. |
| `data/luts/xgb_reduced/*.csv` | `export_lut.py` with pass model | Pass-prob aggregates | Mostly single MCS | Needs additional bins/relaxation. |

To regenerate any LUT, rerun the command in the “Generation Steps” section. Update this catalog whenever new tables are produced.
